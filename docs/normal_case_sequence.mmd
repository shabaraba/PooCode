sequenceDiagram
    %% ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ‘ãƒ³ãƒˆå®šç¾©
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant Runtime as å®Ÿè¡Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ 
    participant Lexer as å­—å¥è§£æå™¨
    participant Parser as æ§‹æ–‡è§£æå™¨
    participant AST as æŠ½è±¡æ§‹æ–‡æœ¨
    participant Evaluator as è©•ä¾¡å™¨
    participant Environment as ç’°å¢ƒ

    %% ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œé–‹å§‹
    User->>Runtime: ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œï¼ˆcaseæ–‡ã‚’å«ã‚€é–¢æ•°ï¼‰
    Runtime->>Lexer: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è§£æä¾é ¼
    
    %% å­—å¥è§£æãƒ—ãƒ­ã‚»ã‚¹
    Lexer->>Lexer: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã«åˆ†å‰²
    Lexer-->>Parser: ãƒˆãƒ¼ã‚¯ãƒ³åˆ—ã‚’æ¸¡ã™
    
    %% æ§‹æ–‡è§£æãƒ—ãƒ­ã‚»ã‚¹
    Parser->>Parser: ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒãƒ¼ãƒ‰ä½œæˆ
    
    %% é–¢æ•°å®šç¾©ã®è§£æ
    Parser->>Parser: parseFunctionLiteral()
    Parser->>Parser: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆè§£æ
    Parser->>Parser: é–¢æ•°æœ¬ä½“ï¼ˆBlockStatementï¼‰è§£æ
    
    %% é–¢æ•°å†…ã®caseæ–‡è§£æ
    Parser->>Parser: parseCaseStatement()
    Parser->>Parser: æ¡ä»¶å¼ã®è§£æ
    Parser->>Parser: çµæœãƒ–ãƒ­ãƒƒã‚¯ã®è§£æ
    
    %% ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚±ãƒ¼ã‚¹è§£æï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
    Parser->>Parser: parseDefaultCaseStatement()
    Parser->>Parser: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã®è§£æ
    
    %% ASTæ§‹ç¯‰å®Œäº†
    Parser-->>AST: å®Œæˆã—ãŸAST
    AST-->>Runtime: æ§‹æ–‡è§£æå®Œäº†
    
    %% é–¢æ•°å‘¼ã³å‡ºã—
    Note over User, Runtime: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé–¢æ•°ã‚’å‘¼ã³å‡ºã™
    User->>Runtime: é–¢æ•°å‘¼ã³å‡ºã—ï¼ˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµŒç”±ï¼‰
    Runtime->>Evaluator: é–¢æ•°è©•ä¾¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    
    %% é–¢æ•°è©•ä¾¡
    Evaluator->>Environment: æ–°ã—ã„é–¢æ•°ã‚¹ã‚³ãƒ¼ãƒ—ä½œæˆ
    Environment-->>Evaluator: é–¢æ•°ç’°å¢ƒ
    
    %% ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ğŸ•ã®è¨­å®š
    Evaluator->>Environment: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€¤ã®ãƒã‚¤ãƒ³ãƒ‰
    Evaluator->>Environment: ğŸ•å€¤ã®è¨­å®šï¼ˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¥åŠ›å€¤ï¼‰
    
    %% caseæ–‡ã®è©•ä¾¡
    Evaluator->>Evaluator: evalCaseStatement()
    Evaluator->>Environment: ğŸ•å€¤ã®å–å¾—
    Environment-->>Evaluator: ğŸ•å€¤
    
    %% æ¡ä»¶å¼ã®è©•ä¾¡
    Evaluator->>Evaluator: æ¡ä»¶å¼ã®è©•ä¾¡
    
    %% æ¡ä»¶ã«ã‚ˆã‚‹ãƒ–ãƒ©ãƒ³ãƒ
    alt æ¡ä»¶ãŒçœŸ
        Evaluator->>Evaluator: ãƒ–ãƒ­ãƒƒã‚¯å†…ã®æ–‡ã‚’è©•ä¾¡
        Evaluator->>Environment: ğŸ’©ã«çµæœã‚’è¨­å®š
        Environment-->>Evaluator: è¨­å®šå®Œäº†
        Evaluator-->>Runtime: é–¢æ•°ã®æˆ»ã‚Šå€¤
    else æ¡ä»¶ãŒå½
        Note over Evaluator: æ¬¡ã®caseã¾ãŸã¯defaultã‚’è©•ä¾¡
        Evaluator->>Evaluator: evalDefaultCaseStatement()ï¼ˆå­˜åœ¨ã™ã‚Œã°ï¼‰
        Evaluator->>Environment: ğŸ’©ã«çµæœã‚’è¨­å®š
        Environment-->>Evaluator: è¨­å®šå®Œäº†
        Evaluator-->>Runtime: é–¢æ•°ã®æˆ»ã‚Šå€¤
    end
    
    Runtime-->>User: å‡¦ç†çµæœè¡¨ç¤º