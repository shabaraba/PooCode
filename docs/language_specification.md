# uncode言語仕様書

## 1. 概要

uncode（ウンコード）は、💩をテーマにした独自のプログラミング言語です。シンプルながらも強力な機能を持ち、特にパイプライン処理と条件付き関数定義に特徴があります。この言語は教育目的や趣味のプログラミングに適しています。

## 2. 基本構文

### 2.1 ファイル拡張子

uncodeのソースファイルは以下の拡張子を使用します：
- `.poo`
- `.💩`

### 2.2 変数と代入

uncodeでは、変数宣言は不要で、代入によって自動的に変数が作成されます。代入には `>>` 演算子を使用します。

```
42 >> answer  // answerという変数に42を代入
"hello" >> greeting  // greetingという変数に"hello"を代入
```

### 2.3 特殊変数

uncodeには2つの特殊変数があります：

- `🍕` (ピザ): パイプを通して関数に渡されるパラメータを表します。これは関数の引数とは別で扱います。
- `💩` (プー): 関数の戻り値を表します

これらの特殊変数は関数内で使用され、データの流れを制御します。

### 2.4 パイプライン記法

uncodeの最も特徴的な構文はパイプライン記法 `|>` です。これにより、関数を連鎖させてデータを処理できます。

```
5 |> add 3 |> multiply 2  // (5 + 3) * 2 = 16
```

パイプライン記法は他にも以下のような種類があります。

#### mapパイプライン`+>`

配列またはレンジ式に対して使用できるパイプラインで、次に続く関数を各要素に対して適用させる事ができます。
他言語の配列の高階関数であるmapと同じ挙動をします。

```
[1..3] +> add 100 // [101, 102, 103]の配列になる
```

#### filterパイプライン`?>`

配列またはレンジ式に対して使用できるパイプラインで、次に続く関数の条件で配列をフィルタリング出来ます。
他言語の配列の高階関数であるfilterと同じ挙動をします。

```
def is_even() : int -> bool {
  🍕 |> mod 2 |> eq 0 >> 💩
}

[1..3] ?> is_even // [2]の配列になる
```

#### 並列パイプ `|` 

使用して非同期処理を表現できます。(TODO: 未実装)

### 2.5 コメント

uncodeでは、`//` から行末までがコメントとして扱われます。
また、`/* */`で囲まれた範囲もコメントとして扱われます。

```
// これはコメントです
42 >> answer  // これも行末コメントです
```

## 3. データ型

uncodeでは以下の基本データ型をサポートしています：

### 3.1 基本型

- `int`: 整数型
- `float`: 浮動小数点型
- `bool`: 真偽値型（`true` または `false`）
- `str`: 文字列型
- `null`: null値

### 3.2 複合型

- `array`: 配列型（`[1, 2, 3]` のように表現）
- `hash`: ハッシュマップ型（`{key: value}` のように表現）

### 3.3 Pooオブジェクト

uncodeのすべてのオブジェクトは「Poo」を継承しており、`💩`メンバを持ちます。
このメンバには任意の値を格納でき、オブジェクトのデフォルト値として使用されます。

## 4. 関数

### 4.1 関数定義

関数は `def` キーワードを使用して定義します。

```
def add(a, b): int -> int {
    🍕 + b >> 💩
}
```

関数定義の構文：
```
def [module名.]関数名([パラメータ: 型])[: 入力型 -> 戻り値型] {
    // 関数本体
}
```

関数は引数を0個ないし1個しか取れません。
一度の関数で🍕にトッピング出来るものは１つだけです。

### 4.2 case付き関数定義

uncodeの特徴的な機能として、case付き関数定義があります。これにより、条件によって異なる実装を提供できます。

```
def is_even(): int -> str {
  case 🍕 % 2 == 0: {
    "偶数です" >> 💩
  }
  case default: {
    "奇数です" >> 💩
  }
}
```

この例では、入力が偶数の場合は最初のcase文が実行され、そうでない場合は2番目のcase文が実行されます。

また、実装がインラインでかける場合はcase文の`{}`を省略できます。
```
def is_even(): int -> str {
  case 🍕 % 2 == 0: "偶数です" >> 💩
  case default: "奇数です" >> 💩
}
```

### 4.3 関数呼び出し

関数呼び出しは以下の形式で行います：

```
add(5, 3)  // 通常の呼び出し
5 |> add 3  // パイプライン記法での呼び出し
```

### 4.4 case文

uncodeでは、`case`文を使用して条件分岐を行うことができます。`case`文は関数ブロックのトップレベルでのみ使用可能で、`🍕`変数を評価対象とします。

```
def check_number(): int -> str {
    case 🍕 % 2 == 0:
        "偶数です" >> 💩
    case 🍕 % 2 != 0:
        "奇数です" >> 💩
}
```

この例では、`🍕`が偶数の場合は「偶数です」と表示され、奇数の場合は「奇数です」と表示されます。

## 6. 制御構造

### 6.1 条件分岐

uncodeでは条件分岐は存在せず、case付き関数定義でのみ分岐を実現できます。
if文もswitch文も存在しません。

### 6.2 ループ

uncodeではループ文は存在せず、mapパイプラインとfilterパイプラインのみで表現します。

## 7. 標準ライブラリ

uncodeには以下の標準関数が組み込まれています：

### 7.1 入出力

- `print`: 値を標準出力に表示
- `input`: ユーザーからの入力を取得

### 7.2 型変換

- `to_string`: 値を文字列に変換
- `to_int`: 値を整数に変換
- `to_float`: 値を浮動小数点数に変換
- `to_bool`: 値を真偽値に変換

### 7.3 数学関数

- `add`: 加算
- `sub`: 減算
- `mul`: 乗算
- `div`: 除算
- `mod`: 剰余

### 7.4 論理演算

- `eq`: 等価比較
- `ne`: 非等価比較
- `lt`: 未満比較
- `le`: 以下比較
- `gt`: 超過比較
- `ge`: 以上比較
- `and`: 論理積
- `or`: 論理和
- `not`: 論理否定

### 7.5 配列操作

- `len`: 配列の長さを取得
- `get`: 配列の要素を取得
- `set`: 配列の要素を設定
- `add`: 配列に要素を追加
- `each`: 配列の各要素に関数を適用

## 9. 実行モデル

uncodeはインタプリタ型の言語で、以下の手順で実行されます：

1. レキサー（字句解析器）がソースコードをトークン列に変換
2. パーサー（構文解析器）がトークン列を抽象構文木（AST）に変換
3. インタプリタがASTを評価して実行

## 10. 制限事項

- 現在のバージョンでは、並列処理や非同期処理はサポートされていません
- 大規模なアプリケーション開発には適していません
- パフォーマンスは最適化されていないため、計算量の多い処理には不向きです

## 11. 将来の拡張予定

- モジュールシステムの導入
- 例外処理の強化
- 並列処理のサポート
- パフォーマンスの最適化
