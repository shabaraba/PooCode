# uncode 言語設計ドキュメント

## 基本構造

### 概要
uncodeは💩をテーマにしたインタプリタ型プログラミング言語です。パイプライン記法を採用し、すべてのオブジェクトはPooクラスを継承します。

### ファイル形式
- 拡張子: `.💩` または `.poo`
- 文字コード: UTF-8

## 型システム

### 基本型
- `Int`: 整数型
- `Float`: 浮動小数点型
- `Bool`: 真偽値型
- `Str`: 文字列型
- `List`: リスト型
- `Map`: マップ型
- `Null`: null値

### ユーザー定義型
- `Class`: クラス定義によるカスタム型
- `Enum`: 列挙型

### 型変換
- 明示的な型変換メソッドを提供
  - `to_string`: 文字列への変換
  - `to_int`: 整数への変換
  - `to_float`: 浮動小数点への変換
  - `to_bool`: 真偽値への変換

## 構文

### 変数と代入
- 代入演算子: `>>`
- 変数名の規則: アルファベット、数字、アンダースコアを使用可能（数字から始まらない）
- 変数宣言は不要（代入時に自動的に作成）

```
1 + 2 >> result
```

### パイプライン
- 基本パイプ: `|>`
  - 前の式の結果を次の式の第一引数として渡す
- 並列パイプ: `|`
  - 並列処理を行う（最後に終わった処理が優先）

```
1 |> add 2 |> mul 3 |> print  # 9
```

### 演算子
- 四則演算: `+`, `-`, `*`, `/`, `%`
- 比較演算: `>`, `>=`, `<`, `<=`, `==`, `!=`
- 論理演算: `&&`, `||`, `not`

### 関数定義
- `def` キーワードを使用
- 型注釈: `入力型 -> 出力型`
- 特殊変数:
  - `🍕`: 入力値。関数の第一引数ではない。
  - `💩`: 出力値

```
def add(num): int -> int {
    🍕 + num >> 💩
}
```

### クラス定義
- `class` キーワードを使用
- アクセス修飾子: `public`, `private`
- コンストラクタは特別な構文で呼び出し

```
class Person
    public name
    private age

    def greet(): null -> str {
        "Hello, " + name >> 💩
    }
```

### 条件分岐
- 伝統的なif文はなし
- 関数定義に条件を付加

```
def func() if condition: null -> int { 10 >> 💩 }
def func(): null -> int { 5 >> 💩 }
```

### ループ
- 伝統的なforループはなし
- リストの`each`メソッドを使用

```
[1, 2, 3].each { 🍕 * 2 >> 💩 } |> print  # [2, 4, 6]
```

## スコープ管理

### スコープの種類
1. グローバルスコープ
   - プログラム全体で有効
   - `global` キーワードで宣言

2. 関数スコープ
   - 関数内でのみ有効
   - パイプライン内で定義された変数は、そのパイプライン内でのみ有効

3. クラススコープ
   - クラス内でのみ有効
   - `public`/`private` アクセス修飾子で制御

### 変数の可視性
- グローバル変数: プログラム全体
- ローカル変数: 定義されたスコープ内
- クラスメンバ: アクセス修飾子に従う

## エラーハンドリング

### エラーの種類
1. 構文エラー: パース時に検出
2. 型エラー: 実行時に検出
3. 実行時エラー: 実行時に検出

### エラー処理
- 例外機構は提供しない
- エラーが発生した場合は実行を中断し、エラーメッセージを表示
- 将来的には `Result` 型を導入し、エラーハンドリングを改善する可能性あり

## メモリ管理
- ガベージコレクション方式
- 参照カウント方式を採用
- 循環参照の検出と解決を行う

## 標準ライブラリ

### 基本機能
- 入出力: `print`, `input`
- 文字列操作: `concat`, `split`, `join`
- リスト操作: `each`, `map`, `filter`, `reduce`
- 数学関数: `abs`, `sqrt`, `pow`
- 日時操作: `now`, `format_date`

### 拡張機能
- ファイル操作: `read_file`, `write_file`
- ネットワーク: `http_get`, `http_post`
- JSON操作: `parse_json`, `stringify_json`

## 実装上の補足事項

### 仕様の明確化
1. 型チェック
   - 動的型付けだが、型注釈による型チェックを行う
   - 型不一致の場合はエラーを発生

2. 名前空間
   - クラス名と関数名の衝突を避けるため、名前空間を導入
   - クラスメソッドとグローバル関数を区別

3. 並列処理
   - 並列パイプ `|` の実装はゴルーチンを使用
   - 競合状態の解決は「最後に終わった処理が優先」というルールを適用

4. Unicode対応
   - 絵文字（特に💩）を識別子として使用可能
   - UTF-8エンコーディングを前提

### 拡張機能（将来的な実装）
1. モジュールシステム
   - 複数ファイルにまたがるプログラムの管理
   - インポート機構の提供

2. パッケージ管理
   - サードパーティライブラリの管理
   - 依存関係の解決

3. デバッグ機能
   - ステップ実行
   - 変数監視
   - ブレークポイント設定
